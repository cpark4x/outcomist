# Epic 1: Pattern Recognition & Quick Insight

**Status**: ✅ Validated and shipped
**Duration**: ~30 seconds
**Current Version**: v4.7 (January 2025)

---

## Overview

Epic 1 provides immediate pattern recognition when users bring a decision. In 30 seconds or less, users see the deeper pattern they're actually facing, understand what they're really deciding, and choose whether to explore deeper.

## User Story

**As a decision-maker**, I bring a decision statement and immediately see the deeper pattern I'm actually facing, **so I** understand what I'm really deciding before investing time in exploration.

## Outcome

Users walk away with:
- **Reframed question** that reveals the real issue
- **Pattern identification** using 9 documented patterns
- **Preview** of what deeper exploration (Epic 2) would uncover
- **Clear choice**: Validate the reframe or proceed to Epic 2

## Design Principles

### Speed (30 seconds or less)
Pattern recognition happens fast. Users don't wait—they get immediate insight that reframes their thinking.

### Insight (Non-obvious patterns)
The system identifies deeper patterns beneath surface requests using 9 documented patterns from validated test scenarios.

### Agency (User chooses next step)
After pattern recognition, users choose:
- **Stop here**: Pattern recognition alone provides clarity
- **Continue to Epic 2**: Explore the reframed question deeper

### Transparency (Show reasoning)
Users see why the pattern was detected and how it changes their decision.

---

## Flow

### 1. User Inputs Decision

Users provide a natural language decision statement:

**Examples**:
- "Should I redesign my home office?"
- "Should I start a side business for additional revenue?"
- "What preventative measures should I take for cancer?"
- "Should I build X vs Y feature?"

The input is free-form—no structured format required.

### 2. Pattern Detection

The system analyzes the decision statement against **9 documented patterns**:

1. **Personal Sanctuary** - Home improvement hiding retreat creation
2. **Employability Anxiety** - Side business hiding career insurance
3. **Health Anxiety** - Prevention hiding control seeking
4. **"Additional Revenue" Misframing** - Business hiding security hedge
5. **Popularity Contest Identity Crisis** - Feature decision hiding positioning choice
6. **Scarcity Mindset** - Stable money hiding opportunity
7. **Solution Looking for Problem** - Build idea without validation
8. **Premature Presentation** - Presenting without proof
9. **Stuck in Build Phase** - Scope management, not tooling limitation

See [Pattern Library](../patterns/pattern-library.md) for full documentation of each pattern.

### 3. Reframing

The system reframes the question to reveal the real issue:

**Example Transformation**:
- **Surface**: "Should I redesign my home office?"
- **Reframe**: "How can you create a personal sanctuary that balances work needs with being a space that's truly yours?"

The reframe shifts focus from the surface request to the underlying pattern.

### 4. Preview of Epic 2

The system previews what Epic 2 exploration would uncover:

**Example Preview**:
> "If we explore deeper (Tier 2), I'd ask about:
> - How you actually use this space beyond work
> - What activities make you feel most yourself
> - Who else accesses this space
> - Your appetite for renovation vs. refresh"

This gives users information to decide whether to continue.

### 5. Intent Checking

Users indicate their intent:
- **Validation intent**: "I want to validate whether I'm seeing this correctly"
- **Execution intent**: "I want to explore this and get recommendations"

This helps Epic 2 tailor its approach.

---

## Features

### Feature 1.1: Decision Input

**What it does**: Accepts natural language decision statements

**Implementation**:
- Web interface text input
- No structured format required
- Supports any length (typical: 1-3 sentences)
- Stored in `Session.decision_statement`

### Feature 1.2: Pattern Detection

**What it does**: Identifies which of 9 patterns applies

**Implementation**:
- Claude API with streaming (model: `claude-sonnet-4-20250514`)
- System prompt: `TIER_1_SYSTEM_PROMPT` from `outcomist_shared/prompts.py`
- User prompt: Generated by `get_tier_1_prompt()`
- Temperature: 1.0 (creative pattern matching)
- Max tokens: 1024

**Pattern Library**:
9 documented patterns with:
- **Signals to recognize**: What indicates this pattern
- **Real problem**: What user is actually trying to solve
- **Key questions**: What to ask in Epic 2
- **Common pitfalls**: What NOT to recommend

See [Pattern Library](../patterns/pattern-library.md)

### Feature 1.3: Reframing & Preview

**What it does**: Shows real issue + preview of Epic 2 exploration

**Implementation**:
- Reframes question to reveal deeper pattern
- Previews 2-3 questions Epic 2 would ask
- Shows reasoning behind pattern detection
- Delivered via Server-Sent Events (streaming)

**Output format**:
```
[Pattern identification]
[Reframed question]
[Preview of Epic 2 questions]
[Call-to-action to continue]
```

### Feature 1.4: Intent Checking

**What it does**: Captures whether user wants validation or execution

**Implementation**:
- User indicates intent after Epic 1 completes
- Stored in `Session.intent` (validation | execution)
- Informs Epic 2 approach:
  - **Validation**: More exploratory, question assumptions
  - **Execution**: Focus on actionable recommendations

---

## Technical Implementation

### Architecture

**Engine**: `ExplorationEngine` (`outcomist_web/backend/engine.py`)

**Method**: `generate_tier_1(session: Session) -> AsyncGenerator[str, None]`

**Flow**:
1. Add user message to conversation
2. Generate prompt using `get_tier_1_prompt()`
3. Stream response from Claude API
4. Append assistant message to conversation
5. Save session state

### System Prompt

**Location**: `outcomist_shared/prompts.py::TIER_1_SYSTEM_PROMPT`

**Key instructions**:
- Use 9 documented patterns
- Reveal deeper pattern beneath surface request
- Reframe question to show real issue
- Preview Epic 2 exploration
- Encourage continuation if relevant

### API Endpoint

**Route**: `GET /api/sessions/{id}/stream`

**Implementation**: Server-Sent Events (SSE) stream

**Response format**:
```
data: {"chunk": "text"}
data: {"chunk": "more text"}
...
data: {"done": true}
```

### Session State

**Stored in**: `Session.conversation` (list of `Message` objects)

**After Epic 1**:
```python
{
  "id": "session_id",
  "decision_statement": "original input",
  "conversation": [
    {"role": "user", "content": "decision statement"},
    {"role": "assistant", "content": "pattern recognition + reframe + preview"}
  ],
  "intent": None,  # Set after user indicates intent
  "current_tier": 1
}
```

---

## Validation & Testing

### Test Coverage

**Validated across 13 test scenarios** documenting real decisions:

1. Test #2: Office Redesign → Personal Sanctuary pattern
2. Test #3: Passive Income → Employability Anxiety + Additional Revenue Misframing
3. Test #4: Cancer Prevention → Health Anxiety pattern
4. Test #5: Feature Decision → Popularity Contest Identity Crisis
5. Test #6: Workplace Politics → Premature Presentation pattern
6. Test #7: Client vs Product → Scarcity Mindset pattern
7. Test #8: Meal Planning App → Solution Looking for Problem
8. Test #9: Ken's Workspaces → Stuck in Build Phase pattern

See [Test Scenarios](../testing/test-scenarios.md) and [Test Results](../testing/results/)

### Success Metrics

**Speed**: Pattern recognition completes in <30 seconds
**Accuracy**: Correctly identifies deeper pattern (validated via user feedback)
**Clarity**: Users understand the reframe and see value
**Agency**: Users can choose to stop or continue

### Known Patterns

9 patterns documented and validated:
- Pattern recognition working well across diverse decision types
- Some decisions match multiple patterns (combinations supported)
- New patterns emerge from test scenarios and feed back into library

---

## Version History

### v4.7 (January 2025)
- **Question type detection**: Distinguish information requests from decision questions
- **Improved routing**: Direct information requests to research, not discovery

### v4.6 (January 2025)
- **Trade-off discovery**: Reveal actual priorities through choices
- **Factual validation**: Research/verify claims before presenting trade-offs
- **Evidence requirement**: "Show me" questions in Epic 2

### v4.5 (January 2025)
- **Partnership tone**: Collaborative language, not expert/advisor tone
- **Transparent reasoning**: Show why recommendations are made
- **Context inference guidelines**: Ask about role/background before assumptions

### Earlier Versions
- Initial pattern recognition implementation
- 9 patterns documented from test scenarios
- Streaming SSE implementation
- Session persistence

---

## Related Documentation

- **Pattern Library**: [docs/patterns/pattern-library.md](../patterns/pattern-library.md)
- **Question Framework**: [docs/patterns/question-framework.md](../patterns/question-framework.md)
- **Epic 2 (Discovery)**: [docs/epics/epic-2-discovery.md](./epic-2-discovery.md)
- **Epic Transitions**: [docs/principles/epic-transitions.md](../principles/epic-transitions.md)
- **End-to-End Flow**: [docs/vision/end-to-end-flow.md](../vision/end-to-end-flow.md)
- **Test Documentation**: [docs/testing/test-scenarios.md](../testing/test-scenarios.md)

---

## Future Enhancements

### Pattern Library Growth
**Goal**: 10+ patterns for robust coverage

**Candidates**:
- Time pressure decisions (job offers, competitive features)
- Ethical dilemmas (manipulate metrics, values conflicts)
- Systemic problems (meeting overload, organizational dysfunction)
- Post-success regret (sold company, pivoted successfully but miss old work)

### Multi-Pattern Detection
**Goal**: Handle decisions matching multiple patterns

**Current**: System can identify combinations (e.g., Employability + Additional Revenue)
**Future**: Explicit multi-pattern handling with priority ranking

### Pattern Confidence Scores
**Goal**: Show confidence in pattern detection

**Benefit**: Users see "90% match for Pattern X" vs "50% match for Pattern Y"
**Implementation**: Would require pattern matching scoring system

---

## Document Status

**Last Updated**: 2025-01-10
**Status**: Complete documentation of validated Epic 1
**Maintainer**: Product team
**Next Review**: After Epic 3 implementation (pattern interactions may emerge)
